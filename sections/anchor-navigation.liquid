{% comment %}
  é”šé“¾æ¥å¯¼èˆªåˆ†åŒº
  Anchor Navigation Section
  
  æ”¯æŒå¤šä¸ªé”šé“¾æ¥æŒ‰é’®ï¼ŒGridå¸ƒå±€ï¼Œæ¯ä¸ªæŒ‰é’®å¯ä»¥è‡ªå®šä¹‰æ ·å¼
  ç‚¹å‡»æŒ‰é’®åå¹³æ»‘æ»šåŠ¨åˆ°é¡µé¢ä¸Šå¯¹åº”çš„é”šç‚¹åˆ†åŒº
{% endcomment %}

{%- liquid
  assign columns_mobile = section.settings.columns_mobile | default: 1
  assign columns_tablet = section.settings.columns_tablet | default: 2
  assign columns_desktop = section.settings.columns_desktop | default: 3
  assign gap_size = section.settings.gap_size | default: 20
-%}

<div 
  id="anchor-nav-{{ section.id }}" 
  class="anchor-navigation-section anchor-navigation-section--spacing-top-{{ section.settings.spacing_top }} anchor-navigation-section--spacing-bottom-{{ section.settings.spacing_bottom }}" 
  {{ section.shopify_attributes }}
  {% if section.settings.background_color != blank or section.settings.background_gradient != blank %} 
    style="{% if section.settings.background_gradient != blank %}background: {{ section.settings.background_gradient }};{% elsif section.settings.background_color != blank %}background-color: {{ section.settings.background_color }};{% endif %}"
  {% endif %}
>
  <div class="anchor-navigation-container anchor-navigation-container--width-{{ section.settings.container_width }}">
    
    {% if section.settings.show_title and section.settings.title != blank %}
      <div class="anchor-navigation-header" style="text-align: {{ section.settings.title_alignment }}; margin-bottom: {{ section.settings.title_spacing }}px;">
        <h2 class="anchor-navigation-title" style="font-size: {{ section.settings.title_size }}px; color: {{ section.settings.title_color }};">
          {{ section.settings.title }}
        </h2>
        {% if section.settings.subtitle != blank %}
          <p class="anchor-navigation-subtitle" style="color: {{ section.settings.subtitle_color }}; font-size: {{ section.settings.subtitle_size }}px;">
            {{ section.settings.subtitle }}
          </p>
        {% endif %}
      </div>
    {% endif %}

    <div 
      class="anchor-navigation-grid"
      style="--columns-mobile: {{ columns_mobile }}; --columns-tablet: {{ columns_tablet }}; --columns-desktop: {{ columns_desktop }}; --gap-size: {{ gap_size }}px;"
    >
      {% for block in section.blocks %}
        {% if block.type == 'anchor_link' %}
          {%- liquid
            assign anchor_target = block.settings.anchor_target
            assign button_text = block.settings.button_text
            assign text_color = block.settings.text_color | default: '#000000'
            assign bg_color = block.settings.bg_color | default: '#ffffff'
            assign border_color = block.settings.border_color | default: '#e0e0e0'
            assign border_width = block.settings.border_width | default: 1
            assign border_radius = block.settings.border_radius | default: 8
            assign padding_top = block.settings.padding_top | default: 12
            assign padding_bottom = block.settings.padding_bottom | default: 12
            assign padding_left = block.settings.padding_left | default: 24
            assign padding_right = block.settings.padding_right | default: 24
            assign bg_image = block.settings.bg_image
            assign hover_text_color = block.settings.hover_text_color
            assign hover_bg_color = block.settings.hover_bg_color
            assign hover_border_color = block.settings.hover_border_color
          -%}
          
          <a 
            href="#{{ anchor_target }}" 
            class="anchor-navigation-button"
            {{ block.shopify_attributes }}
            style="
              color: {{ text_color }};
              background-color: {{ bg_color }};
              border: {{ border_width }}px solid {{ border_color }};
              border-radius: {{ border_radius }}px;
              padding: {{ padding_top }}px {{ padding_right }}px {{ padding_bottom }}px {{ padding_left }}px;
              {% if bg_image != blank %}background-image: url('{{ bg_image | image_url: width: 1200 }}'); background-size: cover; background-position: center;{% endif %}
            "
            data-anchor-target="{{ anchor_target }}"
            data-hover-text-color="{{ hover_text_color }}"
            data-hover-bg-color="{{ hover_bg_color }}"
            data-hover-border-color="{{ hover_border_color }}"
          >
            {% if block.settings.icon != blank %}
              <span class="anchor-navigation-button__icon">
                <img 
                  src="{{ block.settings.icon | image_url: width: 40 }}" 
                  alt="{{ button_text | escape }}"
                  width="40"
                  height="40"
                  loading="lazy"
                >
              </span>
            {% endif %}
            <span class="anchor-navigation-button__text">{{ button_text }}</span>
          </a>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>

<style>
  /* å…¨å±€å¹³æ»‘æ»šåŠ¨ */
  html {
    scroll-behavior: smooth;
  }

  /* é”šé“¾æ¥å¯¼èˆªåˆ†åŒº */
  .anchor-navigation-section {
    width: 100%;
  }

  /* å®¹å™¨ */
  .anchor-navigation-container {
    width: 100%;
    margin-left: auto;
    margin-right: auto;
    padding-left: 1.25rem;
    padding-right: 1.25rem;
  }
  
  .anchor-navigation-container--width-standard { max-width: 85.5rem; }
  .anchor-navigation-container--width-wide { max-width: 100rem; }
  .anchor-navigation-container--width-narrow { max-width: 64rem; }
  .anchor-navigation-container--width-full { max-width: 100%; padding-left: 0; padding-right: 0; }

  /* æ ‡é¢˜åŒºåŸŸ */
  .anchor-navigation-header {
    width: 100%;
  }

  .anchor-navigation-title {
    margin: 0 0 0.5rem 0;
    font-weight: 600;
    line-height: 1.2;
  }

  .anchor-navigation-subtitle {
    margin: 0;
    line-height: 1.5;
  }

  /* Grid å¸ƒå±€ */
  .anchor-navigation-grid {
    display: grid;
    grid-template-columns: repeat(var(--columns-mobile), 1fr);
    gap: var(--gap-size);
    width: 100%;
  }

  /* é”šé“¾æ¥æŒ‰é’® */
  .anchor-navigation-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-decoration: none;
    font-weight: 500;
    font-size: 1rem;
    line-height: 1.5;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    min-height: 48px;
    box-sizing: border-box;
  }

  /* èƒŒæ™¯å›¾è¦†ç›–å±‚ï¼ˆå¦‚æœæœ‰èƒŒæ™¯å›¾ï¼‰ */
  .anchor-navigation-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: inherit;
    opacity: 0.9;
    z-index: 0;
    transition: opacity 0.3s ease;
  }

  .anchor-navigation-button:hover::before {
    opacity: 0.8;
  }

  .anchor-navigation-button__text,
  .anchor-navigation-button__icon {
    position: relative;
    z-index: 1;
  }

  /* æŒ‰é’®å†…å®¹ */
  .anchor-navigation-button__text {
    flex: 1;
  }

  .anchor-navigation-button__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .anchor-navigation-button__icon img {
    width: auto;
    height: 24px;
    object-fit: contain;
  }

  /* æ‚¬åœæ•ˆæœ - é€šè¿‡ JavaScript åº”ç”¨ */
  .anchor-navigation-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  /* é—´è· */
  .anchor-navigation-section--spacing-top-none { padding-top: 0; }
  .anchor-navigation-section--spacing-top-small { padding-top: 2rem; }
  .anchor-navigation-section--spacing-top-medium { padding-top: 4rem; }
  .anchor-navigation-section--spacing-top-large { padding-top: 6rem; }
  
  .anchor-navigation-section--spacing-bottom-none { padding-bottom: 0; }
  .anchor-navigation-section--spacing-bottom-small { padding-bottom: 2rem; }
  .anchor-navigation-section--spacing-bottom-medium { padding-bottom: 4rem; }
  .anchor-navigation-section--spacing-bottom-large { padding-bottom: 6rem; }

  /* å“åº”å¼è®¾è®¡ - å¹³æ¿ */
  @media screen and (min-width: 768px) {
    .anchor-navigation-grid {
      grid-template-columns: repeat(var(--columns-tablet), 1fr);
    }
  }

  /* å“åº”å¼è®¾è®¡ - æ¡Œé¢ */
  @media screen and (min-width: 1024px) {
    .anchor-navigation-grid {
      grid-template-columns: repeat(var(--columns-desktop), 1fr);
    }
  }

  /* å“åº”å¼è®¾è®¡ - ç§»åŠ¨ç«¯ */
  @media screen and (max-width: 767px) {
    .anchor-navigation-container {
      padding-left: 1rem;
      padding-right: 1rem;
    }
    
    .anchor-navigation-section--spacing-top-medium { padding-top: 2.5rem; }
    .anchor-navigation-section--spacing-top-large { padding-top: 3rem; }
    .anchor-navigation-section--spacing-bottom-medium { padding-bottom: 2.5rem; }
    .anchor-navigation-section--spacing-bottom-large { padding-bottom: 3rem; }

    .anchor-navigation-button {
      font-size: 0.9375rem;
      min-height: 44px;
    }
  }
</style>

<script>
  // é™çº§å¤åˆ¶æ–¹æ³•ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰
  function fallbackCopyAnchorId(anchorId) {
    const textArea = document.createElement('textarea');
    textArea.value = anchorId;
    textArea.style.position = 'fixed';
    textArea.style.top = '0';
    textArea.style.left = '0';
    textArea.style.width = '2em';
    textArea.style.height = '2em';
    textArea.style.padding = '0';
    textArea.style.border = 'none';
    textArea.style.outline = 'none';
    textArea.style.boxShadow = 'none';
    textArea.style.background = 'transparent';
    textArea.style.opacity = '0';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
      const successful = document.execCommand('copy');
      if (successful) {
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        const buttons = document.querySelectorAll('.anchor-section__label-copy, button[onclick*="copyAnchorId"], .anchor-nav-helper button');
        buttons.forEach(function(btn) {
          const onclickAttr = btn.getAttribute('onclick') || '';
          const dataAnchorId = btn.getAttribute('data-anchor-id') || '';
          if (onclickAttr.includes(anchorId) || dataAnchorId === anchorId || (btn.onclick && btn.onclick.toString().includes(anchorId))) {
            const originalText = btn.textContent || btn.innerHTML;
            const originalBg = btn.style ? btn.style.backgroundColor : '';
            btn.textContent = 'å·²å¤åˆ¶!';
            btn.innerHTML = 'å·²å¤åˆ¶!';
            btn.classList.add('copied');
            if (btn.style) {
              btn.setAttribute('data-original-bg', originalBg);
              btn.style.backgroundColor = '#28a745';
            }
            setTimeout(function() {
              btn.textContent = originalText;
              btn.innerHTML = originalText;
              btn.classList.remove('copied');
              if (btn.style && btn.getAttribute('data-original-bg')) {
                btn.style.backgroundColor = btn.getAttribute('data-original-bg');
              }
            }, 2000);
          }
        });
        
        if (window.Shopify && window.Shopify.designMode) {
          console.log('å·²å¤åˆ¶é”šç‚¹ID: ' + anchorId);
        } else {
          alert('å·²å¤åˆ¶é”šç‚¹ID: ' + anchorId);
        }
        document.body.removeChild(textArea);
        return true;
      } else {
        throw new Error('execCommand copy å¤±è´¥');
      }
    } catch (err) {
      console.error('å¤åˆ¶å¤±è´¥:', err);
      if (document.body.contains(textArea)) {
        document.body.removeChild(textArea);
      }
      alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶: ' + anchorId);
      return false;
    }
  }

  // ç¡®ä¿ copyAnchorId å‡½æ•°å¯ç”¨ï¼ˆå¦‚æœåœ¨ anchor-section ä¸­å·²å®šä¹‰åˆ™ä½¿ç”¨ï¼Œå¦åˆ™åˆ›å»ºï¼‰
  if (typeof window.copyAnchorId !== 'function') {
    window.copyAnchorId = function(anchorId) {
      if (!anchorId) {
        console.warn('å¤åˆ¶é”šç‚¹IDå¤±è´¥ï¼šé”šç‚¹IDä¸ºç©º');
        return;
      }

      // ä½¿ç”¨ç°ä»£ Clipboard API
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(anchorId).then(function() {
          // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º - æ›´æ–°æ‰€æœ‰ç›¸å…³çš„å¤åˆ¶æŒ‰é’®
          const buttons = document.querySelectorAll('.anchor-section__label-copy, button[onclick*="copyAnchorId"], .anchor-nav-helper button');
          buttons.forEach(function(btn) {
            const onclickAttr = btn.getAttribute('onclick') || '';
            const dataAnchorId = btn.getAttribute('data-anchor-id') || '';
            if (onclickAttr.includes(anchorId) || dataAnchorId === anchorId || (btn.onclick && btn.onclick.toString().includes(anchorId))) {
              const originalText = btn.textContent || btn.innerHTML;
              const originalBg = btn.style ? btn.style.backgroundColor : '';
              btn.textContent = 'å·²å¤åˆ¶!';
              btn.innerHTML = 'å·²å¤åˆ¶!';
              btn.classList.add('copied');
              if (btn.style) {
                btn.setAttribute('data-original-bg', originalBg);
                btn.style.backgroundColor = '#28a745';
              }
              setTimeout(function() {
                btn.textContent = originalText;
                btn.innerHTML = originalText;
                btn.classList.remove('copied');
                if (btn.style && btn.getAttribute('data-original-bg')) {
                  btn.style.backgroundColor = btn.getAttribute('data-original-bg');
                }
              }, 2000);
            }
          });

          // åœ¨ä¸»é¢˜ç¼–è¾‘å™¨æ¨¡å¼ä¸‹ï¼Œæ˜¾ç¤ºæç¤º
          if (window.Shopify && window.Shopify.designMode) {
            console.log('å·²å¤åˆ¶é”šç‚¹ID: ' + anchorId);
          }
        }).catch(function(err) {
          console.error('å¤åˆ¶å¤±è´¥:', err);
          // é™çº§åˆ°ä¼ ç»Ÿæ–¹æ³•
          fallbackCopyAnchorId(anchorId);
        });
      } else {
        // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
        fallbackCopyAnchorId(anchorId);
      }
    };
  }

  // æ£€æµ‹é¡µé¢ä¸Šæ‰€æœ‰å¯ç”¨çš„é”šç‚¹IDï¼ˆç”¨äºè¾…åŠ©é…ç½®ï¼‰
  function detectAllAnchors() {
    const anchors = [];
    
    // æŸ¥æ‰¾æ‰€æœ‰æœ‰IDçš„å…ƒç´ ï¼ˆåŒ…æ‹¬é”šé“¾æ¥è·³è½¬åˆ†åŒºï¼‰
    const elementsWithId = document.querySelectorAll('[id]');
    elementsWithId.forEach(function(el) {
      const id = el.getAttribute('id');
      // è¿‡æ»¤æ‰ä¸€äº›å¸¸è§çš„ç³»ç»ŸID
      if (id && 
          !id.startsWith('shopify-section-') && 
          !id.startsWith('shopify-section-header') &&
          !id.startsWith('shopify-section-footer') &&
          id !== 'shopify-section-theme' &&
          id.length > 0) {
        const label = el.getAttribute('data-anchor-id') || 
                      el.querySelector('[data-anchor-label] code')?.textContent ||
                      el.classList.contains('anchor-section') ? 'é”šé“¾æ¥è·³è½¬åˆ†åŒº' : 
                      el.tagName.toLowerCase() + ' å…ƒç´ ';
        anchors.push({
          id: id,
          label: label,
          element: el
        });
      }
    });

    // ç‰¹åˆ«æŸ¥æ‰¾é”šé“¾æ¥è·³è½¬åˆ†åŒº
    const anchorSections = document.querySelectorAll('[data-anchor-id]');
    anchorSections.forEach(function(section) {
      const id = section.getAttribute('data-anchor-id');
      if (id && !anchors.find(a => a.id === id)) {
        anchors.push({
          id: id,
          label: 'é”šé“¾æ¥è·³è½¬åˆ†åŒº',
          element: section
        });
      }
    });

    return anchors;
  }

  // åœ¨ä¸»é¢˜ç¼–è¾‘å™¨æ¨¡å¼ä¸‹æ˜¾ç¤ºé”šç‚¹æ£€æµ‹æç¤º
  function showAnchorDetectionHelper() {
    if (!window.Shopify || !window.Shopify.designMode) return;

    const navSection = document.querySelector('#anchor-nav-{{ section.id }}');
    if (!navSection) return;

    const anchors = detectAllAnchors();
    if (anchors.length === 0) {
      const helper = document.createElement('div');
      helper.className = 'anchor-nav-helper';
      helper.style.cssText = 'background: #fff3cd; border: 2px solid #ffc107; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem; font-size: 0.875rem; color: #856404;';
      helper.innerHTML = '<strong>ğŸ’¡ æç¤ºï¼š</strong>æœªæ£€æµ‹åˆ°é¡µé¢ä¸Šçš„é”šç‚¹ã€‚è¯·å…ˆåœ¨é¡µé¢ä¸Šæ·»åŠ ã€Œé”šé“¾æ¥è·³è½¬åˆ†åŒºã€å¹¶è®¾ç½®é”šç‚¹IDã€‚';
      navSection.insertBefore(helper, navSection.querySelector('.anchor-navigation-grid'));
    } else {
      const helper = document.createElement('div');
      helper.className = 'anchor-nav-helper';
      helper.style.cssText = 'background: #d1ecf1; border: 2px solid #0c5460; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem; font-size: 0.875rem; color: #0c5460;';
      
      let html = '<strong>ğŸ“‹ é¡µé¢ä¸Šå¯ç”¨çš„é”šç‚¹IDï¼š</strong><br><ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem;">';
      anchors.forEach(function(anchor) {
        // è½¬ä¹‰ anchor.id ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œé˜²æ­¢XSSå’ŒJavaScripté”™è¯¯
        const escapedAnchorId = anchor.id.replace(/'/g, "\\'").replace(/"/g, '&quot;').replace(/\n/g, '').replace(/\r/g, '');
        html += '<li style="margin: 0.25rem 0; display: flex; align-items: center; gap: 0.5rem;">' +
                '<code style="background: #fff; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-family: monospace; flex: 1;">' + 
                anchor.id + '</code> ' + 
                '<button onclick="window.copyAnchorId(\'' + escapedAnchorId + '\')" ' +
                'style="padding: 0.125rem 0.5rem; background: #0c5460; color: #fff; border: none; border-radius: 0.25rem; cursor: pointer; font-size: 0.75rem; transition: background-color 0.2s ease;" ' +
                'data-anchor-id="' + escapedAnchorId + '" ' +
                'onmouseover="this.style.backgroundColor=\'#0a4650\'" ' +
                'onmouseout="if(!this.classList.contains(\'copied\')) this.style.backgroundColor=\'#0c5460\'">å¤åˆ¶</button></li>';
      });
      html += '</ul><div style="margin-top: 0.5rem; font-size: 0.8125rem; color: #0c5460;">ğŸ’¡ æç¤ºï¼šå¤åˆ¶é”šç‚¹IDåï¼Œåœ¨æŒ‰é’®è®¾ç½®ä¸­ç²˜è´´åˆ°ã€Œé”šç‚¹IDã€å­—æ®µã€‚</div>';
      helper.innerHTML = html;
      
      // ç¡®ä¿ helper æ’å…¥åˆ°æ­£ç¡®ä½ç½®
      const gridElement = navSection.querySelector('.anchor-navigation-grid');
      if (gridElement) {
        navSection.insertBefore(helper, gridElement);
      } else {
        const container = navSection.querySelector('.anchor-navigation-container');
        if (container) {
          container.insertBefore(helper, container.firstChild);
        }
      }
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    const buttons = document.querySelectorAll('.anchor-navigation-button[data-anchor-target]');
    const scrollOffset = {{ section.settings.scroll_offset | default: 0 }};

    // åœ¨ä¸»é¢˜ç¼–è¾‘å™¨æ¨¡å¼ä¸‹æ˜¾ç¤ºé”šç‚¹æ£€æµ‹è¾…åŠ©å·¥å…·
    if (window.Shopify && window.Shopify.designMode) {
      setTimeout(showAnchorDetectionHelper, 500);
    }

    buttons.forEach(function(button) {
      // ä¿å­˜åŸå§‹æ ·å¼ï¼ˆä»å†…è”æ ·å¼æˆ–è®¡ç®—æ ·å¼è·å–ï¼‰
      const computedStyle = window.getComputedStyle(button);
      const originalStyles = {
        color: button.style.color || computedStyle.color,
        backgroundColor: button.style.backgroundColor || computedStyle.backgroundColor,
        borderColor: button.style.borderColor || computedStyle.borderColor
      };

      // æ‚¬åœæ•ˆæœ
      const hoverTextColor = button.getAttribute('data-hover-text-color');
      const hoverBgColor = button.getAttribute('data-hover-bg-color');
      const hoverBorderColor = button.getAttribute('data-hover-border-color');

      if (hoverTextColor || hoverBgColor || hoverBorderColor) {
        button.addEventListener('mouseenter', function() {
          if (hoverTextColor && hoverTextColor.trim() !== '') {
            this.style.color = hoverTextColor;
          }
          if (hoverBgColor && hoverBgColor.trim() !== '') {
            this.style.backgroundColor = hoverBgColor;
          }
          if (hoverBorderColor && hoverBorderColor.trim() !== '') {
            this.style.borderColor = hoverBorderColor;
          }
        });

        button.addEventListener('mouseleave', function() {
          // æ¢å¤åŸå§‹æ ·å¼
          if (hoverTextColor && hoverTextColor.trim() !== '') {
            this.style.color = originalStyles.color || '';
          }
          if (hoverBgColor && hoverBgColor.trim() !== '') {
            this.style.backgroundColor = originalStyles.backgroundColor || '';
          }
          if (hoverBorderColor && hoverBorderColor.trim() !== '') {
            this.style.borderColor = originalStyles.borderColor || '';
          }
        });
      }

      // é”šé“¾æ¥ç‚¹å‡»å¤„ç†
      button.addEventListener('click', function(e) {
        const targetId = this.getAttribute('data-anchor-target');
        if (!targetId) return;

        // å¦‚æœé”šç‚¹IDä¸åŒ…å« #ï¼Œåˆ™æ·»åŠ 
        const anchorId = targetId.startsWith('#') ? targetId : '#' + targetId;
        const targetElement = document.querySelector(anchorId);

        if (targetElement) {
          e.preventDefault();
          
          // è®¡ç®—ç›®æ ‡ä½ç½®ï¼ˆè€ƒè™‘æ»šåŠ¨åç§»ï¼‰
          const elementPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
          const offsetPosition = elementPosition - scrollOffset;

          // å¹³æ»‘æ»šåŠ¨
          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });

          // æ›´æ–°URLï¼ˆä¸åˆ·æ–°é¡µé¢ï¼‰
          if (history.pushState) {
            history.pushState(null, null, anchorId);
          }
        }
      });
    });

    // é¡µé¢åŠ è½½æ—¶ï¼Œå¦‚æœURLä¸­æœ‰é”šé“¾æ¥ï¼Œè‡ªåŠ¨æ»šåŠ¨
    if (window.location.hash) {
      const anchorId = window.location.hash;
      const targetElement = document.querySelector(anchorId);
      
      if (targetElement) {
        setTimeout(function() {
          const elementPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
          const offsetPosition = elementPosition - scrollOffset;
          
          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });
        }, 100);
      }
    }

    // æ£€æŸ¥æŒ‰é’®é“¾æ¥çš„ç›®æ ‡é”šç‚¹æ˜¯å¦å­˜åœ¨ï¼Œå¹¶åœ¨ä¸»é¢˜ç¼–è¾‘å™¨æ¨¡å¼ä¸‹æç¤º
    if (window.Shopify && window.Shopify.designMode) {
      buttons.forEach(function(button) {
        const targetId = button.getAttribute('data-anchor-target');
        if (targetId) {
          const anchorId = targetId.startsWith('#') ? targetId : '#' + targetId;
          const targetElement = document.querySelector(anchorId);
          
          if (!targetElement) {
            button.style.borderColor = '#dc3545';
            button.style.borderWidth = '2px';
            button.title = 'è­¦å‘Šï¼šæ‰¾ä¸åˆ°é”šç‚¹IDä¸º "' + targetId + '" çš„ç›®æ ‡åˆ†åŒºï¼è¯·æ£€æŸ¥é”šç‚¹IDæ˜¯å¦æ­£ç¡®ã€‚';
            console.warn('é”šé“¾æ¥å¯¼èˆªï¼šæ‰¾ä¸åˆ°é”šç‚¹IDä¸º "' + targetId + '" çš„ç›®æ ‡åˆ†åŒº');
          }
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "é”šé“¾æ¥å¯¼èˆª",
  "tag": "section",
  "class": "section-anchor-navigation",
  "settings": [
    {
      "type": "header",
      "content": "æ ‡é¢˜è®¾ç½®"
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "æ˜¾ç¤ºæ ‡é¢˜",
      "default": false
    },
    {
      "type": "text",
      "id": "title",
      "label": "æ ‡é¢˜"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "å‰¯æ ‡é¢˜"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "æ ‡é¢˜å­—ä½“å¤§å°",
      "min": 20,
      "max": 60,
      "step": 2,
      "default": 32,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "label": "å‰¯æ ‡é¢˜å­—ä½“å¤§å°",
      "min": 12,
      "max": 24,
      "step": 1,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "æ ‡é¢˜é¢œè‰²",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "å‰¯æ ‡é¢˜é¢œè‰²",
      "default": "#666666"
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "æ ‡é¢˜å¯¹é½æ–¹å¼",
      "options": [
        { "value": "left", "label": "å·¦å¯¹é½" },
        { "value": "center", "label": "å±…ä¸­" },
        { "value": "right", "label": "å³å¯¹é½" }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "title_spacing",
      "label": "æ ‡é¢˜ä¸‹æ–¹é—´è·",
      "min": 0,
      "max": 80,
      "step": 4,
      "default": 32,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Gridå¸ƒå±€è®¾ç½®"
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "label": "ç§»åŠ¨ç«¯åˆ—æ•°",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 1,
      "unit": "åˆ—"
    },
    {
      "type": "range",
      "id": "columns_tablet",
      "label": "å¹³æ¿åˆ—æ•°",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 2,
      "unit": "åˆ—"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "æ¡Œé¢ç«¯åˆ—æ•°",
      "min": 1,
      "max": 8,
      "step": 1,
      "default": 3,
      "unit": "åˆ—"
    },
    {
      "type": "range",
      "id": "gap_size",
      "label": "æŒ‰é’®é—´è·",
      "min": 0,
      "max": 60,
      "step": 4,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "å®¹å™¨è®¾ç½®"
    },
    {
      "type": "select",
      "id": "container_width",
      "label": "å®¹å™¨å®½åº¦",
      "options": [
        { "value": "standard", "label": "æ ‡å‡† (1368px)" },
        { "value": "wide", "label": "å®½å± (1600px)" },
        { "value": "narrow", "label": "çª„å± (1024px)" },
        { "value": "full", "label": "å…¨å®½" }
      ],
      "default": "standard"
    },
    {
      "type": "header",
      "content": "é—´è·è®¾ç½®"
    },
    {
      "type": "select",
      "id": "spacing_top",
      "label": "ä¸Šé—´è·",
      "options": [
        { "value": "none", "label": "æ— " },
        { "value": "small", "label": "å°" },
        { "value": "medium", "label": "ä¸­" },
        { "value": "large", "label": "å¤§" }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "spacing_bottom",
      "label": "ä¸‹é—´è·",
      "options": [
        { "value": "none", "label": "æ— " },
        { "value": "small", "label": "å°" },
        { "value": "medium", "label": "ä¸­" },
        { "value": "large", "label": "å¤§" }
      ],
      "default": "medium"
    },
    {
      "type": "header",
      "content": "æ»šåŠ¨è®¾ç½®"
    },
    {
      "type": "range",
      "id": "scroll_offset",
      "label": "æ»šåŠ¨åç§»é‡ï¼ˆåƒç´ ï¼‰",
      "info": "å½“é¡µé¢æœ‰å›ºå®šå¤´éƒ¨å¯¼èˆªæ—¶ï¼Œè®¾ç½®æ­¤å€¼ä»¥è°ƒæ•´æ»šåŠ¨ä½ç½®",
      "min": 0,
      "max": 200,
      "step": 10,
      "default": 0,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "èƒŒæ™¯è®¾ç½®"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "èƒŒæ™¯é¢œè‰²"
    },
    {
      "type": "color_background",
      "id": "background_gradient",
      "label": "èƒŒæ™¯æ¸å˜",
      "info": "å¦‚è®¾ç½®æ¸å˜ï¼Œå°†è¦†ç›–èƒŒæ™¯é¢œè‰²"
    }
  ],
  "blocks": [
    {
      "type": "anchor_link",
      "name": "é”šé“¾æ¥æŒ‰é’®",
      "settings": [
        {
          "type": "header",
          "content": "é“¾æ¥è®¾ç½®"
        },
        {
          "type": "text",
          "id": "anchor_target",
          "label": "é”šç‚¹ID",
          "info": "ğŸ’¡ æç¤ºï¼šç›®æ ‡é”šç‚¹çš„IDï¼ˆä¸éœ€è¦åŒ…å« # å·ï¼‰ã€‚\n\nå¦‚ä½•è·å–é”šç‚¹IDï¼Ÿ\n1. åœ¨é¡µé¢ä¸Šæ‰¾åˆ°ç›®æ ‡åˆ†åŒºï¼ˆé”šé“¾æ¥è·³è½¬åˆ†åŒºï¼‰\n2. æŸ¥çœ‹åˆ†åŒºé¡¶éƒ¨æ˜¾ç¤ºçš„é”šç‚¹IDæ ‡ç­¾ï¼ˆğŸ”— é”šç‚¹ID: xxxï¼‰\n3. ç‚¹å‡»æ ‡ç­¾ä¸Šçš„ã€Œå¤åˆ¶ã€æŒ‰é’®ï¼Œæˆ–æ‰‹åŠ¨å¤åˆ¶ID\n4. åœ¨æ­¤å¤„ç²˜è´´ID\n\nä¾‹å¦‚ï¼šabout-usã€product-featuresã€section-anchor-123456\n\nå¦‚æœæ²¡æœ‰è®¾ç½®é”šç‚¹IDæ ‡ç­¾ï¼Œå¯ä»¥ï¼š\n- åœ¨ä¸»é¢˜ç¼–è¾‘å™¨ä¸­ç¼–è¾‘ç›®æ ‡åˆ†åŒº\n- æŸ¥çœ‹å¹¶å¤åˆ¶ã€Œé”šç‚¹IDã€è®¾ç½®ä¸­çš„å€¼\n- å¦‚æœç•™ç©ºï¼Œä¼šä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„IDï¼šsection-anchor-{åˆ†åŒºID}",
          "default": "anchor-section"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "æŒ‰é’®æ–‡å­—",
          "default": "è·³è½¬åˆ°åˆ†åŒº"
        },
        {
          "type": "image_picker",
          "id": "icon",
          "label": "å›¾æ ‡ï¼ˆå¯é€‰ï¼‰",
          "info": "å¯é€‰ï¼šåœ¨æŒ‰é’®æ–‡å­—å‰æ·»åŠ å›¾æ ‡"
        },
        {
          "type": "header",
          "content": "æ ·å¼è®¾ç½®"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "æ–‡å­—é¢œè‰²",
          "default": "#000000"
        },
        {
          "type": "color",
          "id": "bg_color",
          "label": "èƒŒæ™¯é¢œè‰²",
          "default": "#ffffff"
        },
        {
          "type": "color",
          "id": "border_color",
          "label": "è¾¹æ¡†é¢œè‰²",
          "default": "#e0e0e0"
        },
        {
          "type": "range",
          "id": "border_width",
          "label": "è¾¹æ¡†å¤§å°",
          "min": 0,
          "max": 10,
          "step": 1,
          "default": 1,
          "unit": "px"
        },
        {
          "type": "range",
          "id": "border_radius",
          "label": "åœ†è§’ï¼ˆè§’æ ‡ï¼‰",
          "min": 0,
          "max": 50,
          "step": 2,
          "default": 8,
          "unit": "px"
        },
        {
          "type": "image_picker",
          "id": "bg_image",
          "label": "èƒŒæ™¯å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰",
          "info": "å¯é€‰ï¼šè®¾ç½®æŒ‰é’®èƒŒæ™¯å›¾ç‰‡"
        },
        {
          "type": "header",
          "content": "å†…è¾¹è·è®¾ç½®"
        },
        {
          "type": "range",
          "id": "padding_top",
          "label": "ä¸Šå†…è¾¹è·",
          "min": 0,
          "max": 60,
          "step": 2,
          "default": 12,
          "unit": "px"
        },
        {
          "type": "range",
          "id": "padding_bottom",
          "label": "ä¸‹å†…è¾¹è·",
          "min": 0,
          "max": 60,
          "step": 2,
          "default": 12,
          "unit": "px"
        },
        {
          "type": "range",
          "id": "padding_left",
          "label": "å·¦å†…è¾¹è·",
          "min": 0,
          "max": 60,
          "step": 2,
          "default": 24,
          "unit": "px"
        },
        {
          "type": "range",
          "id": "padding_right",
          "label": "å³å†…è¾¹è·",
          "min": 0,
          "max": 60,
          "step": 2,
          "default": 24,
          "unit": "px"
        },
        {
          "type": "header",
          "content": "æ‚¬åœæ•ˆæœï¼ˆå¯é€‰ï¼‰"
        },
        {
          "type": "color",
          "id": "hover_text_color",
          "label": "æ‚¬åœæ—¶æ–‡å­—é¢œè‰²",
          "info": "ç•™ç©ºåˆ™ä¿æŒåŸè‰²"
        },
        {
          "type": "color",
          "id": "hover_bg_color",
          "label": "æ‚¬åœæ—¶èƒŒæ™¯é¢œè‰²",
          "info": "ç•™ç©ºåˆ™ä¿æŒåŸè‰²"
        },
        {
          "type": "color",
          "id": "hover_border_color",
          "label": "æ‚¬åœæ—¶è¾¹æ¡†é¢œè‰²",
          "info": "ç•™ç©ºåˆ™ä¿æŒåŸè‰²"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "[gy] Anchor Navigation",
      "blocks": [
        {
          "type": "anchor_link",
          "settings": {
            "anchor_target": "section-1",
            "button_text": "åˆ†åŒºä¸€"
          }
        },
        {
          "type": "anchor_link",
          "settings": {
            "anchor_target": "section-2",
            "button_text": "åˆ†åŒºäºŒ"
          }
        },
        {
          "type": "anchor_link",
          "settings": {
            "anchor_target": "section-3",
            "button_text": "åˆ†åŒºä¸‰"
          }
        }
      ]
    }
  ]
}
{% endschema %}

