{% comment %}
  Flash Sale 商品网格组件
  专门用于展示 Flash Sale 商品列表，仅使用系统折扣 (compare_at_price / price)

  参数说明:
  - grid_class: 额外的 CSS class (可选)
  - show_reviews: 是否显示评论
  - section_blocks: section.blocks 数组 (用于遍历产品块)
  - filter_category: 过滤分类编号 (可选，用于过滤特定分类的商品)
  - products_per_row: 桌面端每行显示的商品数量 (可选，默认 4)
  - products_per_row_mobile: 移动端每行显示的商品数量 (可选，默认 2)
{% endcomment %}

{%- liquid
  assign products_per_row = products_per_row | default: 4
  assign products_per_row_mobile = products_per_row_mobile | default: 2
-%}

<div class='product-grid product-grid--flash product-grid--per-row-{{ products_per_row }} product-grid--per-row-mob-{{ products_per_row_mobile }}{% if grid_class %} {{ grid_class }}{% endif %}'>
  {% if section_blocks %}
    {% comment %} 使用 section.blocks 遍历 {% endcomment %}
    {% for block in section_blocks %}
      {% if block.type == 'product_item' %}
        {% comment %} 如果有分类过滤，检查是否属于当前分类 {% endcomment %}
        {% if filter_category %}
          {% assign parent_num = block.settings.parent_tab_number | plus: 0 %}

          {% if parent_num == filter_category %}
            {% assign product = block.settings.product %}

            {% render 'product-card-flash',
              product: product,
              show_reviews: show_reviews,
              custom_image: block.settings.custom_image,
              custom_title: block.settings.custom_title,
              custom_description: block.settings.custom_description,
              shopify_attributes: block.shopify_attributes
            %}
          {% endif %}

        {% else %}
          {% comment %} 没有分类过滤，直接渲染所有产品 {% endcomment %}
          {% assign product = block.settings.product %}

          {% render 'product-card-flash',
            product: product,
            show_reviews: show_reviews,
            custom_image: block.settings.custom_image,
            custom_title: block.settings.custom_title,
            custom_description: block.settings.custom_description,
            shopify_attributes: block.shopify_attributes
          %}
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}
</div>
